import{r as a,m as de,j as e,B as L,G as xe,a as pe}from"./index-0ef130ba.js";import{u as ge}from"./useQuery-630941b5.js";import{M as he,T as ue,d as fe,a as O,b as k,P,l as U}from"./index-5f01d85c.js";import{C as z,M as me}from"./index-8bb8f9fd.js";import{M as g,r as $,a as ye}from"./index.esm-c5ebd630.js";import{S as m,B as be}from"./index.esm-90b7f790.js";import{E as Y}from"./index-2108e7ff.js";import{R as je,C as v}from"./row-4524a560.js";import{T as ve}from"./index-778a740c.js";import"./index-df21fa8f.js";import"./CheckOutlined-fa640ea2.js";import"./useLocale-1aa94a16.js";const{useBreakpoint:Se}=xe,{Text:S}=ve;var _e=(i=>(i.中山區="中山區",i.中正區="中正區",i.信義區="信義區",i.內湖區="內湖區",i.北投區="北投區",i.南港區="南港區",i.士林區="士林區",i.大同區="大同區",i.大安區="大安區",i.文山區="文山區",i.松山區="松山區",i.臺大公館校區="臺大公館校區",i.萬華區="萬華區",i))(_e||{}),we=(i=>(i.BeitouDist="Beitou Dist",i.DaanDist="Daan Dist.",i.DatongDist="Datong Dist",i.NTUDist="NTU Dist",i.NangangDist="Nangang Dist",i.NeihuDist="Neihu Dist",i.ShilinDist="Shilin Dist",i.SongshanDist="Songshan Dist",i.WanhuaDist="Wanhua Dist",i.WenshanDist="Wenshan Dist",i.XinyiDist="Xinyi Dist",i.ZhongshanDist="Zhongshan Dist",i.ZhongzhengDist="Zhongzheng Dist",i))(we||{});const _=({title:i,children:y,bodyStyle:n})=>e.jsx(e.Fragment,{children:e.jsx(z,{title:i,headStyle:{backgroundColor:"#002FA7",color:"white",textAlign:"center",borderRadius:0},bodyStyle:{padding:3,height:"299px",userSelect:"text",...n},children:y})});function Le(){const[i,y]=a.useState({center:[25.035751357120876,121.52047467202769],zoom:12}),[n,G]=a.useState(),[w,R]=a.useState(0),[d,V]=a.useState(0),[T,Z]=a.useState(0),[A,J]=a.useState(["",""]),[H,X]=a.useState(0),[Q,q]=a.useState(0),[F,M]=a.useState(!1),[C,K]=de.useMessage(),l=Se();a.useEffect(()=>{const t=localStorage.getItem("page3_02-viewport");t&&y(JSON.parse(t))},[]);const ee=async()=>{try{return(await pe.get("https://tcgbusfs.blob.core.windows.net/dotapp/youbike/v2/youbike_immediate.json")).data}catch(t){console.log(t.message)}};console.log("render....");const{data:p,status:te,isLoading:h,isFetching:u}=ge(["TaipeiYouBike"],ee,{refetchOnWindowFocus:!1,keepPreviousData:!0,cacheTime:6e4,staleTime:1/0,refetchInterval:6e4});a.useEffect(()=>{te==="success"&&(console.log("data",p),G(p))},[p]);const ie=t=>{localStorage.setItem("page3_02-viewport",JSON.stringify(t))};a.useEffect(()=>{localStorage.setItem("page3_02-viewport",JSON.stringify(i))},[F]);const se=()=>U.divIcon({className:"",html:$(e.jsx(e.Fragment,{children:e.jsx(ye,{style:{color:"#263ea0",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}})}))}),ne=(t,s,o,r)=>U.divIcon({className:"",html:$(e.jsx("div",{children:r==="1"&&s/o>=3?e.jsx(g,{style:{color:"#cf1322",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):r==="1"&&s/o>=2?e.jsx(g,{style:{color:"#d48806",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):r==="1"?e.jsx(g,{style:{color:"#006400",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):r==="0"&&e.jsx(be,{style:{color:"#dc3545",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}})},t))}),oe=({total:t,available_return_bikes:s,available_rent_bikes:o,updateTime:r})=>{const x=(s/t*100).toFixed(2);return{tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},graphic:[{type:"text",left:"center",top:"35%",style:{text:"目前使用量",textAlign:"center",fill:"#555",fontSize:16,fontWeight:"bold"}},{type:"text",left:"center",top:"45%",style:{text:`${x} %`,textAlign:"center",fill:"#555",fontSize:20,fontWeight:"bold"}},{type:"text",left:"center",top:"88%",style:{text:`上次更新時間 ${r}`,textAlign:"center",fill:"#555",fontSize:20,fontWeight:"bold"}}],series:[{name:"Access From",type:"pie",radius:["45%","66%"],center:["50%","45%"],avoidLabelOverlap:!1,label:l.xs?{show:!1}:{show:!0,position:"outside",formatter:`{b}
{c}`,fontSize:14},emphasis:{label:{show:!l.xs,fontSize:16,fontWeight:"bold"}},labelLine:l.xs?{show:!1}:{show:!0},data:[{value:s,name:"可還空位數"},{value:o,name:"可借車位數"}]}]}};a.useEffect(()=>{var B,I,E,W;const t=n==null?void 0:n.map(c=>c.total),s=t==null?void 0:t.reduce((c,f)=>c+f+0),o=n==null?void 0:n.map(c=>c.available_return_bikes),r=o==null?void 0:o.reduce((c,f)=>c+f+0),x=n==null?void 0:n.map(c=>c.available_rent_bikes),j=x==null?void 0:x.reduce((c,f)=>c+f+0),ae=(I=(B=n==null?void 0:n[600])==null?void 0:B.mday)==null?void 0:I.toString().slice(-8),ce=(W=(E=n==null?void 0:n[600])==null?void 0:E.mday)==null?void 0:W.toString().slice(0,10);R(s),V(r),Z(j),J([ce,ae])},[n]);const le=()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){const{latitude:s,longitude:o}=t.coords;X(s),q(o),y(r=>({...r,center:[s,o],zoom:l.xs?16:18})),M(!0)},function(t){t.code===t.PERMISSION_DENIED?C.warning("請開啟瀏覽器位置存取權限!"):console.log(`無法取得位置：${t.message}`)}):(C.error("瀏覽器不支援地理位置服務"),console.log("瀏覽器不支援地理位置服務"))},N=p==null?void 0:p.reduce((t,s)=>{const{sarea:o}=s;return t[o]||(t[o]=[]),t[o].push(s),t},{}),b={};function D(t,s){return t.reduce((o,r)=>o+Number(r[s]),0)}N&&Object.entries(N).forEach(([t,s])=>{const o=D(s,"total"),r=D(s,"available_return_bikes"),x=D(s,"available_rent_bikes"),j=(r/o*100).toFixed(2);b[t]={total:o,available_return_bikes:r,available_rent_bikes:x,util:j}}),console.log(b);const re={xAxis:{type:"category",data:Object.keys(b),axisLabel:{interval:0,rotate:45}},yAxis:{type:"value"},series:[{data:Object.values(b).map(t=>t.util),type:"bar",showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},label:{show:!0,offset:[130,-130],position:"insideBottom",formatter:"{c} %",rotate:40,color:"gary",fontWeight:"bold"}}]};return e.jsxs(e.Fragment,{children:[e.jsxs(je,{children:[e.jsx(v,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(_,{title:"目前場站所有總停車格",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:h||u||w===0||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx("h1",{style:{fontSize:"3.8rem",fontWeight:"bold",color:"#002FA7"},children:w})})}),e.jsx(v,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(_,{title:"目前所有可還空位數",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:h||u||d===0||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx("h1",{style:{fontSize:"3.8rem",fontWeight:"bold",color:"#002FA7"},children:d})})}),e.jsx(v,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(_,{title:"各行政區使用量",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:h||u||T===0||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx(Y,{option:re,style:{height:"303px",width:"100%"},notMerge:!0,lazyUpdate:!0})})}),e.jsx(v,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(_,{title:"當前使用量 ｜ 數據更新時間",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:h||u||A[1]===""||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx(Y,{option:oe({total:w,available_return_bikes:d,available_rent_bikes:T,updateTime:A[1]}),style:{height:"303px",width:"100%"},notMerge:!0,lazyUpdate:!0})})})]}),e.jsxs(z,{bodyStyle:{margin:5,padding:0,height:"100%"},children:[e.jsx("div",{style:{margin:0,padding:0},children:e.jsxs(he,{viewport:i,onViewportChange:ie,style:{height:"calc(55vh - 65px)"},children:[e.jsx(ue,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> 貢獻者',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsxs(fe,{disableClusteringAtZoom:16,removeOutsideVisibleBounds:!0,spiderfyDistanceMultiplier:1,showCoverageOnHover:!0,maxClusterRadius:35,children:[n==null?void 0:n.map((t,s)=>e.jsxs(O,{position:[t.latitude,t.longitude],icon:ne(s,t.total,t.available_rent_bikes,t.act),children:[e.jsx(k,{direction:"bottom",offset:[0,7],children:t.sna}),e.jsx(P,{offset:[0,-13],children:e.jsxs(z,{bodyStyle:l.xs?{display:"inline-block",padding:"5px 0 5px 0"}:{display:"inline-block",padding:15},children:[e.jsx(me,{title:e.jsx("div",{style:l.xs?{fontSize:"1rem",padding:"0 15px 0 15px"}:{fontSize:"1.2rem",maxWidth:"244px",whiteSpace:"pre-line"},children:l.xs?t.sna.replace(/\([^)]*\)/g,"").replace("YouBike2.0_",""):t.sna.replace("YouBike2.0_","")}),description:t.sarea,style:l.xs?{fontSize:"0.9rem",textAlign:"center"}:{textAlign:"center"}}),e.jsx("hr",{style:{color:"gray",width:"90%",marginTop:"10px"}}),h||u?e.jsx(e.Fragment,{children:e.jsx(m,{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",height:"171.93800px"}})}):e.jsxs(e.Fragment,{children:[t.total&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["場站總停車格：",t.total]}):e.jsxs("p",{children:["場站總停車格：",t.total]})}),t.available_rent_bikes>=0&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["可借車位數：",t.available_rent_bikes]}):e.jsxs("p",{children:["可借車位數：",t.available_rent_bikes]})}),t.available_return_bikes&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["可還空位數：",t.available_return_bikes]}):e.jsxs("p",{children:["可還空位數：",t.available_return_bikes]})}),t.mday&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 10px 0",padding:"0 0 0 15px"},children:["更新時間：",t.mday.slice(11,19)]}):e.jsxs("p",{children:["上次更新時間：",t.mday]})}),t.latitude&&t.longitude&&(l.xs?e.jsx(e.Fragment,{children:e.jsx("a",{href:`comgooglemaps://?daddr=${t.latitude},${t.longitude}&directionsmode=walking`,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"1rem",textAlign:"left",padding:"0 0 0 15px",margin:"0 0 10px 0 "},children:"打開 Google 地圖導航"})}):e.jsx(e.Fragment,{children:e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${t.latitude},${t.longitude}`,target:"_blank",rel:"noopener noreferrer",children:"打開 Google 地圖導航"})})),t.act==="0"&&e.jsx(e.Fragment,{children:e.jsx("p",{style:l.xs?{color:"red",textAlign:"center",fontSize:"1.2rem",fontWeight:"bold"}:{color:"red",textAlign:"center",fontSize:"1.2rem",margin:"10px 0 0 0 ",fontWeight:"bold"},children:"此站目前為禁用狀態"})})]})]})})]},`${t.latitude}-${t.longitude}-${s}`)),F&&e.jsxs(O,{position:[H,Q],icon:se(),children:[e.jsx(k,{direction:"bottom",offset:[-3,8],permanent:!0,children:"我的位置"}),e.jsx(P,{offset:[-3,-13],closeButton:!1,children:e.jsx(L,{onClick:()=>M(!1),children:"close Marker"})})]})]})]})}),e.jsxs("div",{style:{marginTop:"5px",display:"flex",justifyContent:"space-between",alignItems:"baseline",flexDirection:l.xs?"column":"row"},children:[e.jsxs("div",{children:[e.jsxs(S,{style:{verticalAlign:"4px"},children:["臺北市 YouBike2.0 即時資訊："," "]}),e.jsx(g,{style:{color:"#006400",fontSize:"1.3rem"}}),e.jsx(S,{style:{verticalAlign:"4px"},children:" 充足 "}),e.jsx(g,{style:{color:"#d48806",fontSize:"1.3rem"}}),e.jsx(S,{style:{verticalAlign:"4px"},children:" 適中 "}),e.jsx(g,{style:{color:"#cf1322",fontSize:"1.3rem"}}),e.jsx(S,{style:{verticalAlign:"4px"},children:" 有限 "})]}),e.jsx("div",{children:e.jsx(L,{style:{verticalAlign:"4px",padding:"0 5px 0 5px"},onClick:le,children:"尋找我的座標"})})]})]}),K]})}export{_e as Sarea,we as Sareaen,Le as default};
