import{g as ht,K as lt,c as yt,d as bt,r as l,C as at,e as A,o as St,i as Q,f as q,m as jt,j as e,B as k,G as vt,a as zt}from"./index-a9af6b0d.js";import{u as wt}from"./useQuery-62694eea.js";import{M as Ct,T as Dt,d as $t,a as tt,b as et,P as it,l as nt}from"./index-949dba88.js";import{C as U,M as Nt}from"./index-7919ea47.js";import{G as Tt,M as O,r as ot,a as Et}from"./index.esm-8938b0f5.js";import{E as st}from"./index-ffb13352.js";import{R as It,C as _}from"./row-738cec8d.js";import{T as Mt}from"./index-dbd8e645.js";import"./index-1ccfb6f0.js";import"./CheckOutlined-1f23841f.js";import"./useLocale-b5d15c50.js";function Ot(t,o,n){var s=n||{},c=s.noTrailing,y=c===void 0?!1:c,p=s.noLeading,z=p===void 0?!1:p,C=s.debounceMode,b=C===void 0?void 0:C,u,D=!1,$=0;function S(){u&&clearTimeout(u)}function M(j){var m=j||{},x=m.upcomingOnly,T=x===void 0?!1:x;S(),D=!T}function N(){for(var j=arguments.length,m=new Array(j),x=0;x<j;x++)m[x]=arguments[x];var T=this,r=Date.now()-$;if(D)return;function w(){$=Date.now(),o.apply(T,m)}function f(){u=void 0}!z&&b&&!u&&w(),S(),b===void 0&&r>t?z?($=Date.now(),y||(u=setTimeout(b?f:w,t))):w():y!==!0&&(u=setTimeout(b?f:w,b===void 0?t-r:t))}return N.cancel=M,N}function At(t,o,n){var s=n||{},c=s.atBegin,y=c===void 0?!1:c;return Ot(t,o,{debounceMode:y!==!1})}const Ft=new lt("antSpinMove",{to:{opacity:1}}),Lt=new lt("antRotate",{to:{transform:"rotate(405deg)"}}),Pt=t=>({[`${t.componentCls}`]:Object.assign(Object.assign({},bt(t)),{position:"absolute",display:"none",color:t.colorPrimary,fontSize:0,textAlign:"center",verticalAlign:"middle",opacity:0,transition:`transform ${t.motionDurationSlow} ${t.motionEaseInOutCirc}`,"&-spinning":{position:"static",display:"inline-block",opacity:1},"&-nested-loading":{position:"relative",[`> div > ${t.componentCls}`]:{position:"absolute",top:0,insetInlineStart:0,zIndex:4,display:"block",width:"100%",height:"100%",maxHeight:t.contentHeight,[`${t.componentCls}-dot`]:{position:"absolute",top:"50%",insetInlineStart:"50%",margin:-t.dotSize/2},[`${t.componentCls}-text`]:{position:"absolute",top:"50%",width:"100%",paddingTop:(t.dotSize-t.fontSize)/2+2,textShadow:`0 1px 2px ${t.colorBgContainer}`,fontSize:t.fontSize},[`&${t.componentCls}-show-text ${t.componentCls}-dot`]:{marginTop:-(t.dotSize/2)-10},"&-sm":{[`${t.componentCls}-dot`]:{margin:-t.dotSizeSM/2},[`${t.componentCls}-text`]:{paddingTop:(t.dotSizeSM-t.fontSize)/2+2},[`&${t.componentCls}-show-text ${t.componentCls}-dot`]:{marginTop:-(t.dotSizeSM/2)-10}},"&-lg":{[`${t.componentCls}-dot`]:{margin:-(t.dotSizeLG/2)},[`${t.componentCls}-text`]:{paddingTop:(t.dotSizeLG-t.fontSize)/2+2},[`&${t.componentCls}-show-text ${t.componentCls}-dot`]:{marginTop:-(t.dotSizeLG/2)-10}}},[`${t.componentCls}-container`]:{position:"relative",transition:`opacity ${t.motionDurationSlow}`,"&::after":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:10,width:"100%",height:"100%",background:t.colorBgContainer,opacity:0,transition:`all ${t.motionDurationSlow}`,content:'""',pointerEvents:"none"}},[`${t.componentCls}-blur`]:{clear:"both",opacity:.5,userSelect:"none",pointerEvents:"none","&::after":{opacity:.4,pointerEvents:"auto"}}},"&-tip":{color:t.spinDotDefault},[`${t.componentCls}-dot`]:{position:"relative",display:"inline-block",fontSize:t.dotSize,width:"1em",height:"1em","&-item":{position:"absolute",display:"block",width:(t.dotSize-t.marginXXS/2)/2,height:(t.dotSize-t.marginXXS/2)/2,backgroundColor:t.colorPrimary,borderRadius:"100%",transform:"scale(0.75)",transformOrigin:"50% 50%",opacity:.3,animationName:Ft,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"alternate","&:nth-child(1)":{top:0,insetInlineStart:0},"&:nth-child(2)":{top:0,insetInlineEnd:0,animationDelay:"0.4s"},"&:nth-child(3)":{insetInlineEnd:0,bottom:0,animationDelay:"0.8s"},"&:nth-child(4)":{bottom:0,insetInlineStart:0,animationDelay:"1.2s"}},"&-spin":{transform:"rotate(45deg)",animationName:Lt,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&-sm ${t.componentCls}-dot`]:{fontSize:t.dotSizeSM,i:{width:(t.dotSizeSM-t.marginXXS/2)/2,height:(t.dotSizeSM-t.marginXXS/2)/2}},[`&-lg ${t.componentCls}-dot`]:{fontSize:t.dotSizeLG,i:{width:(t.dotSizeLG-t.marginXXS)/2,height:(t.dotSizeLG-t.marginXXS)/2}},[`&${t.componentCls}-show-text ${t.componentCls}-text`]:{display:"block"}})}),Bt=ht("Spin",t=>{const o=yt(t,{spinDotDefault:t.colorTextDescription});return[Pt(o)]},t=>({contentHeight:400,dotSize:t.controlHeightLG/2,dotSizeSM:t.controlHeightLG*.35,dotSizeLG:t.controlHeight}));var Gt=globalThis&&globalThis.__rest||function(t,o){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&o.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(t);c<s.length;c++)o.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(t,s[c])&&(n[s[c]]=t[s[c]]);return n};let R=null;function _t(t,o){const{indicator:n}=o,s=`${t}-dot`;return n===null?null:Q(n)?q(n,{className:A(n.props.className,s)}):Q(R)?q(R,{className:A(R.props.className,s)}):l.createElement("span",{className:A(s,`${t}-dot-spin`)},l.createElement("i",{className:`${t}-dot-item`,key:1}),l.createElement("i",{className:`${t}-dot-item`,key:2}),l.createElement("i",{className:`${t}-dot-item`,key:3}),l.createElement("i",{className:`${t}-dot-item`,key:4}))}function Wt(t,o){return!!t&&!!o&&!isNaN(Number(o))}const Xt=t=>{const{spinPrefixCls:o,spinning:n=!0,delay:s=0,className:c,rootClassName:y,size:p="default",tip:z,wrapperClassName:C,style:b,children:u,hashId:D}=t,$=Gt(t,["spinPrefixCls","spinning","delay","className","rootClassName","size","tip","wrapperClassName","style","children","hashId"]),[S,M]=l.useState(()=>n&&!Wt(n,s));l.useEffect(()=>{if(n){const E=At(s,()=>{M(!0)});return E(),()=>{var v;(v=E==null?void 0:E.cancel)===null||v===void 0||v.call(E)}}M(!1)},[s,n]);const N=l.useMemo(()=>typeof u<"u",[u]),{direction:j,spin:m}=l.useContext(at),x=A(o,m==null?void 0:m.className,{[`${o}-sm`]:p==="small",[`${o}-lg`]:p==="large",[`${o}-spinning`]:S,[`${o}-show-text`]:!!z,[`${o}-rtl`]:j==="rtl"},c,y,D),T=A(`${o}-container`,{[`${o}-blur`]:S}),r=St($,["indicator","prefixCls"]),w=Object.assign(Object.assign({},m==null?void 0:m.style),b),f=l.createElement("div",Object.assign({},r,{style:w,className:x,"aria-live":"polite","aria-busy":S}),_t(o,t),z&&N?l.createElement("div",{className:`${o}-text`},z):null);return N?l.createElement("div",Object.assign({},r,{className:A(`${o}-nested-loading`,C,D)}),S&&l.createElement("div",{key:"loading"},f),l.createElement("div",{className:T,key:"container"},u)):f},rt=t=>{const{prefixCls:o}=t,{getPrefixCls:n}=l.useContext(at),s=n("spin",o),[c,y]=Bt(s),p=Object.assign(Object.assign({},t),{spinPrefixCls:s,hashId:y});return c(l.createElement(Xt,Object.assign({},p)))};rt.setDefaultIndicator=t=>{R=t};const P=rt;function Rt(t){return Tt({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M3 4v12c0 1.103.897 2 2 2h3.5l3.5 4 3.5-4H19c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2H5c-1.103 0-2 .897-2 2zm8 1h2v6h-2V5zm0 8h2v2h-2v-2z"}}]})(t)}const{useBreakpoint:Ht}=vt,{Text:W}=Mt;var Ut=(t=>(t.中山區="中山區",t.中正區="中正區",t.信義區="信義區",t.內湖區="內湖區",t.北投區="北投區",t.南港區="南港區",t.士林區="士林區",t.大同區="大同區",t.大安區="大安區",t.文山區="文山區",t.松山區="松山區",t.臺大公館校區="臺大公館校區",t.萬華區="萬華區",t))(Ut||{}),Yt=(t=>(t.BeitouDist="Beitou Dist",t.DaanDist="Daan Dist.",t.DatongDist="Datong Dist",t.NTUDist="NTU Dist",t.NangangDist="Nangang Dist",t.NeihuDist="Neihu Dist",t.ShilinDist="Shilin Dist",t.SongshanDist="Songshan Dist",t.WanhuaDist="Wanhua Dist",t.WenshanDist="Wenshan Dist",t.XinyiDist="Xinyi Dist",t.ZhongshanDist="Zhongshan Dist",t.ZhongzhengDist="Zhongzheng Dist",t))(Yt||{});const X=({title:t,children:o,bodyStyle:n})=>e.jsx(e.Fragment,{children:e.jsx(U,{title:t,headStyle:{backgroundColor:"#002FA7",color:"white",textAlign:"center",borderRadius:0},bodyStyle:{padding:3,height:"299px",userSelect:"text",...n},children:o})});function oe(){const[t,o]=l.useState({center:[25.035751357120876,121.52047467202769],zoom:12}),[n,s]=l.useState(),[c,y]=l.useState(0),[p,z]=l.useState(0),[C,b]=l.useState(0),[u,D]=l.useState(["",""]),[$,S]=l.useState(0),[M,N]=l.useState(0),[j,m]=l.useState(!1),[x,T]=jt.useMessage(),r=Ht();l.useEffect(()=>{const i=localStorage.getItem("page3_02-viewport");i&&o(JSON.parse(i))},[]);const w=async()=>{try{return(await zt.get("https://tcgbusfs.blob.core.windows.net/dotapp/youbike/v2/youbike_immediate.json")).data}catch(i){console.log(i.message)}};console.log("render....");const{data:f,status:E,isLoading:v,isFetching:F}=wt(["TaipeiYouBike"],w,{refetchOnWindowFocus:!1,keepPreviousData:!0,cacheTime:6e4,staleTime:1/0,refetchInterval:6e4});l.useEffect(()=>{E==="success"&&(console.log("data",f),s(f))},[f]);const ct=i=>{localStorage.setItem("page3_02-viewport",JSON.stringify(i))};l.useEffect(()=>{localStorage.setItem("page3_02-viewport",JSON.stringify(t))},[j]);const dt=()=>nt.divIcon({className:"",html:ot(e.jsx(e.Fragment,{children:e.jsx(Et,{style:{color:"#263ea0",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}})}))}),pt=(i,a,d,g)=>nt.divIcon({className:"",html:ot(e.jsx("div",{children:g==="1"&&a/d>=3?e.jsx(O,{style:{color:"#cf1322",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):g==="1"&&a/d>=2?e.jsx(O,{style:{color:"#d48806",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):g==="1"?e.jsx(O,{style:{color:"#006400",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):g==="0"&&e.jsx(Rt,{style:{color:"#dc3545",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}})},i))}),gt=({tot:i,bemp:a,sbi:d,updateTime:g})=>{const I=(a/i*100).toFixed(2);return{tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},graphic:[{type:"text",left:"center",top:"35%",style:{text:"目前使用量",textAlign:"center",fill:"#555",fontSize:16,fontWeight:"bold"}},{type:"text",left:"center",top:"45%",style:{text:`${I} %`,textAlign:"center",fill:"#555",fontSize:20,fontWeight:"bold"}},{type:"text",left:"center",top:"88%",style:{text:`上次更新時間 ${g}`,textAlign:"center",fill:"#555",fontSize:20,fontWeight:"bold"}}],series:[{name:"Access From",type:"pie",radius:["45%","66%"],center:["50%","45%"],avoidLabelOverlap:!1,label:r.xs?{show:!1}:{show:!0,position:"outside",formatter:`{b}
{c}`,fontSize:14},emphasis:{label:{show:!r.xs,fontSize:16,fontWeight:"bold"}},labelLine:r.xs?{show:!1}:{show:!0},data:[{value:a,name:"可還空位數"},{value:d,name:"可借車位數"}]}]}};l.useEffect(()=>{var V,Z,J,K;const i=n==null?void 0:n.map(h=>h.tot),a=i==null?void 0:i.reduce((h,L)=>h+L+0),d=n==null?void 0:n.map(h=>h.bemp),g=d==null?void 0:d.reduce((h,L)=>h+L+0),I=n==null?void 0:n.map(h=>h.sbi),G=I==null?void 0:I.reduce((h,L)=>h+L+0),xt=(Z=(V=n==null?void 0:n[600])==null?void 0:V.mday)==null?void 0:Z.toString().slice(-8),ft=(K=(J=n==null?void 0:n[600])==null?void 0:J.mday)==null?void 0:K.toString().slice(0,10);y(a),z(g),b(G),D([ft,xt])},[n]);const mt=()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(i){const{latitude:a,longitude:d}=i.coords;S(a),N(d),o(g=>({...g,center:[a,d],zoom:r.xs?16:18})),m(!0)},function(i){i.code===i.PERMISSION_DENIED?x.warning("請開啟瀏覽器位置存取權限!"):console.log(`無法取得位置：${i.message}`)}):(x.error("瀏覽器不支援地理位置服務"),console.log("瀏覽器不支援地理位置服務"))},Y=f==null?void 0:f.reduce((i,a)=>{const{sarea:d}=a;return i[d]||(i[d]=[]),i[d].push(a),i},{}),B={};function H(i,a){return i.reduce((d,g)=>d+Number(g[a]),0)}Y&&Object.entries(Y).forEach(([i,a])=>{const d=H(a,"tot"),g=H(a,"bemp"),I=H(a,"sbi"),G=(g/d*100).toFixed(2);B[i]={tot:d,bemp:g,sbi:I,util:G}}),console.log(B);const ut={xAxis:{type:"category",data:Object.keys(B),axisLabel:{interval:0,rotate:45}},yAxis:{type:"value"},series:[{data:Object.values(B).map(i=>i.util),type:"bar",showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},label:{show:!0,offset:[130,-130],position:"insideBottom",formatter:"{c} %",rotate:40,color:"gary",fontWeight:"bold"}}]};return e.jsxs(e.Fragment,{children:[e.jsxs(It,{children:[e.jsx(_,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(X,{title:"目前場站所有總停車格",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:v||F||c===0||p===void 0?e.jsx(e.Fragment,{children:e.jsx(P,{})}):e.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#002FA7"},children:c})})}),e.jsx(_,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(X,{title:"目前所有可還空位數",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:v||F||p===0||p===void 0?e.jsx(e.Fragment,{children:e.jsx(P,{})}):e.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#002FA7"},children:p})})}),e.jsx(_,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(X,{title:"各行政區使用量",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:v||F||C===0||p===void 0?e.jsx(e.Fragment,{children:e.jsx(P,{})}):e.jsx(st,{option:ut,style:{height:"303px",width:"100%"},notMerge:!0,lazyUpdate:!0})})}),e.jsx(_,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(X,{title:"當前使用量 ｜ 數據更新時間",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:v||F||u[1]===""||p===void 0?e.jsx(e.Fragment,{children:e.jsx(P,{})}):e.jsx(st,{option:gt({tot:c,bemp:p,sbi:C,updateTime:u[1]}),style:{height:"303px",width:"100%"},notMerge:!0,lazyUpdate:!0})})})]}),e.jsxs(U,{bodyStyle:{margin:5,padding:0,height:"100%"},children:[e.jsx("div",{style:{margin:0,padding:0},children:e.jsxs(Ct,{viewport:t,onViewportChange:ct,style:{height:"calc(55vh - 65px)"},children:[e.jsx(Dt,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> 貢獻者',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsxs($t,{disableClusteringAtZoom:16,removeOutsideVisibleBounds:!0,spiderfyDistanceMultiplier:1,showCoverageOnHover:!0,maxClusterRadius:35,children:[n==null?void 0:n.map((i,a)=>e.jsxs(tt,{position:[i.lat,i.lng],icon:pt(a,i.tot,i.sbi,i.act),children:[e.jsx(et,{direction:"bottom",offset:[0,7],children:i.sna}),e.jsx(it,{offset:[0,-13],children:e.jsxs(U,{bodyStyle:r.xs?{display:"inline-block",padding:"5px 0 5px 0"}:{display:"inline-block",padding:15},children:[e.jsx(Nt,{title:e.jsx("div",{style:r.xs?{fontSize:"1rem",padding:"0 15px 0 15px"}:{fontSize:"1.2rem",maxWidth:"244px",whiteSpace:"pre-line"},children:r.xs?i.sna.replace(/\([^)]*\)/g,"").replace("YouBike2.0_",""):i.sna.replace("YouBike2.0_","")}),description:i.sarea,style:r.xs?{fontSize:"0.9rem",textAlign:"center"}:{textAlign:"center"}}),e.jsx("hr",{style:{color:"gray",width:"90%",marginTop:"10px"}}),v||F?e.jsx(e.Fragment,{children:e.jsx(P,{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",height:"171.93800px"}})}):e.jsxs(e.Fragment,{children:[i.tot&&e.jsx(e.Fragment,{children:r.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["場站總停車格：",i.tot]}):e.jsxs("p",{children:["場站總停車格：",i.tot]})}),i.sbi>=0&&e.jsx(e.Fragment,{children:r.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["可借車位數：",i.sbi]}):e.jsxs("p",{children:["可借車位數：",i.sbi]})}),i.bemp&&e.jsx(e.Fragment,{children:r.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["可還空位數：",i.bemp]}):e.jsxs("p",{children:["可還空位數：",i.bemp]})}),i.mday&&e.jsx(e.Fragment,{children:r.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 10px 0",padding:"0 0 0 15px"},children:["更新時間：",i.mday.slice(11,19)]}):e.jsxs("p",{children:["上次更新時間：",i.mday]})}),i.lat&&i.lng&&(r.xs?e.jsx(e.Fragment,{children:e.jsx("a",{href:`comgooglemaps://?daddr=${i.lat},${i.lng}&directionsmode=walking`,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"1rem",textAlign:"left",padding:"0 0 0 15px",margin:"0 0 10px 0 "},children:"打開 Google 地圖導航"})}):e.jsx(e.Fragment,{children:e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${i.lat},${i.lng}`,target:"_blank",rel:"noopener noreferrer",children:"打開 Google 地圖導航"})})),i.act==="0"&&e.jsx(e.Fragment,{children:e.jsx("p",{style:r.xs?{color:"red",textAlign:"center",fontSize:"1.2rem",fontWeight:"bold"}:{color:"red",textAlign:"center",fontSize:"1.2rem",margin:"10px 0 0 0 ",fontWeight:"bold"},children:"此站目前為禁用狀態"})})]})]})})]},`${i.lat}-${i.lng}-${a}`)),j&&e.jsxs(tt,{position:[$,M],icon:dt(),children:[e.jsx(et,{direction:"bottom",offset:[-3,8],permanent:!0,children:"我的位置"}),e.jsx(it,{offset:[-3,-13],closeButton:!1,children:e.jsx(k,{onClick:()=>m(!1),children:"close Marker"})})]})]})]})}),e.jsxs("div",{style:{marginTop:"5px",display:"flex",justifyContent:"space-between",alignItems:"baseline",flexDirection:r.xs?"column":"row"},children:[e.jsxs("div",{children:[e.jsxs(W,{style:{verticalAlign:"4px"},children:["臺北市 YouBike2.0 即時資訊："," "]}),e.jsx(O,{style:{color:"#006400",fontSize:"1.3rem"}}),e.jsx(W,{style:{verticalAlign:"4px"},children:" 充足 "}),e.jsx(O,{style:{color:"#d48806",fontSize:"1.3rem"}}),e.jsx(W,{style:{verticalAlign:"4px"},children:" 適中 "}),e.jsx(O,{style:{color:"#cf1322",fontSize:"1.3rem"}}),e.jsx(W,{style:{verticalAlign:"4px"},children:" 有限 "})]}),e.jsx("div",{children:e.jsx(k,{style:{verticalAlign:"4px",padding:"0 5px 0 5px"},onClick:mt,children:"尋找我的座標"})})]})]}),T]})}export{Ut as Sarea,Yt as Sareaen,oe as default};
