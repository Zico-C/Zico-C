import{_ as M,f as v,h as O,n as x,S as g,R as p,p as C,i as j,k as S,r as b,j as o}from"./index-b999ebff.js";import{s as E,u as w}from"./useQuery-a04a45be.js";import{s as y}from"./page8_01.module-ce61cfc9.js";var P=function(i){M(u,i);function u(n,e){var t;return t=i.call(this)||this,t.client=n,t.setOptions(e),t.bindMethods(),t.updateResult(),t}var r=u.prototype;return r.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},r.setOptions=function(e){this.options=this.client.defaultMutationOptions(e)},r.onUnsubscribe=function(){if(!this.listeners.length){var e;(e=this.currentMutation)==null||e.removeObserver(this)}},r.onMutationUpdate=function(e){this.updateResult();var t={listeners:!0};e.type==="success"?t.onSuccess=!0:e.type==="error"&&(t.onError=!0),this.notify(t)},r.getCurrentResult=function(){return this.currentResult},r.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},r.mutate=function(e,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,v({},this.options,{variables:typeof e<"u"?e:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},r.updateResult=function(){var e=this.currentMutation?this.currentMutation.state:O(),t=v({},e,{isLoading:e.status==="loading",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=t},r.notify=function(e){var t=this;x.batch(function(){t.mutateOptions&&(e.onSuccess?(t.mutateOptions.onSuccess==null||t.mutateOptions.onSuccess(t.currentResult.data,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(t.currentResult.data,null,t.currentResult.variables,t.currentResult.context)):e.onError&&(t.mutateOptions.onError==null||t.mutateOptions.onError(t.currentResult.error,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(void 0,t.currentResult.error,t.currentResult.variables,t.currentResult.context))),e.listeners&&t.listeners.forEach(function(c){c(t.currentResult)})})},u}(g);function R(i,u,r){var n=p.useRef(!1),e=p.useState(0),t=e[1],c=C(i,u,r),f=j(),a=p.useRef();a.current?a.current.setOptions(c):a.current=new P(f,c);var l=a.current.getCurrentResult();p.useEffect(function(){n.current=!0;var d=a.current.subscribe(x.batchCalls(function(){n.current&&t(function(h){return h+1})}));return function(){n.current=!1,d()}},[]);var m=p.useCallback(function(d,h){a.current.mutate(d,h).catch(S)},[]);if(l.error&&E(void 0,a.current.options.useErrorBoundary,[l.error]))throw l.error;return v({},l,{mutate:m,mutateAsync:l.mutate})}const T=async()=>await(await fetch("https://my-json-server.typicode.com/Zico-C/Zico-C/posts")).json(),Z=async({id:i,title:u,subtitle:r,author:n,memberNum:e})=>await(await fetch("https://my-json-server.typicode.com/Zico-C/Zico-C/posts",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:i,title:u,subtitle:r,author:n,memberNum:e})})).json(),q=async i=>await(await fetch(`https://my-json-server.typicode.com/Zico-C/Zico-C/posts/${i}`,{method:"DELETE",headers:{"content-type":"application/json"}})).json();function D(){const[i,u]=b.useState(""),[r,n]=b.useState(""),{data:e,isSuccess:t}=w(["posts"],T),c=j(),f=R(Z,{onSuccess:s=>{c.invalidateQueries("posts"),console.log("創建Post成功",s)},onError:s=>{console.log("創建Post失敗",s)},onSettled:()=>{console.log("創建Post操作成功")}}),a=R(q,{onSuccess:s=>{c.invalidateQueries("posts"),console.log("刪除成功",s)},onError:s=>{console.error("刪除失敗",s)},onSettled:()=>{console.log("刪除操作完成")}});function l(){return Math.floor(Math.random()*1e5)+Date.now()}const m=l(),d=()=>{f.mutate({id:0,title:i,subtitle:r,author:"ZICO",memberNum:m}),u(""),n("")},h=s=>{a.mutate(s)};return o.jsx(o.Fragment,{children:o.jsxs("div",{className:y.main,children:[o.jsxs("form",{children:[o.jsx("input",{type:"text",placeholder:"title",value:i,onChange:s=>u(s.target.value)}),o.jsx("input",{type:"text",placeholder:"subTitle",value:r,onChange:s=>n(s.target.value)})]}),t&&e.map(s=>o.jsxs("div",{children:[o.jsxs("p",{children:["id：",s.id]}),o.jsxs("p",{children:["title：",s.title]}),o.jsxs("p",{children:["subTitle：",s.subtitle]}),o.jsxs("p",{children:["author：",s.author]}),o.jsxs("p",{children:["memberNum：",s.memberNum]}),o.jsx("button",{onClick:()=>h(s.id),className:y.delete,children:"Delete Post"}),o.jsx("hr",{color:"red"})]},s.id)),o.jsx("button",{onClick:d,children:"Create Post"})]})})}export{D as default};
