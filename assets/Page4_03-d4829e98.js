import{r as a,m as je,j as e,B as _,G as be,a as U}from"./index-0ef130ba.js";import{u as $}from"./useQuery-630941b5.js";import{M as we,T as ve,d as Se,a as G,b as R,P as V,l as Z}from"./index-5f01d85c.js";import{C as M,M as De}from"./index-8bb8f9fd.js";import{M as g,r as k,a as ze}from"./index.esm-c5ebd630.js";import{S as m,B as Te}from"./index.esm-90b7f790.js";import{E as J}from"./index-2108e7ff.js";import{R as Ae,C as S}from"./row-4524a560.js";import{T as Fe}from"./index-778a740c.js";import"./index-df21fa8f.js";import"./CheckOutlined-fa640ea2.js";import"./useLocale-1aa94a16.js";const{useBreakpoint:Me}=be,{Text:D}=Fe;var Ne=(s=>(s.中山區="中山區",s.中正區="中正區",s.信義區="信義區",s.內湖區="內湖區",s.北投區="北投區",s.南港區="南港區",s.士林區="士林區",s.大同區="大同區",s.大安區="大安區",s.文山區="文山區",s.松山區="松山區",s.臺大公館校區="臺大公館校區",s.萬華區="萬華區",s))(Ne||{}),Ie=(s=>(s.BeitouDist="Beitou Dist",s.DaanDist="Daan Dist.",s.DatongDist="Datong Dist",s.NTUDist="NTU Dist",s.NangangDist="Nangang Dist",s.NeihuDist="Neihu Dist",s.ShilinDist="Shilin Dist",s.SongshanDist="Songshan Dist",s.WanhuaDist="Wanhua Dist",s.WenshanDist="Wenshan Dist",s.XinyiDist="Xinyi Dist",s.ZhongshanDist="Zhongshan Dist",s.ZhongzhengDist="Zhongzheng Dist",s))(Ie||{});const z=({title:s,children:y,bodyStyle:o})=>e.jsx(e.Fragment,{children:e.jsx(M,{title:s,headStyle:{backgroundColor:"#002FA7",color:"white",textAlign:"center",borderRadius:0},bodyStyle:{padding:3,height:"299px",userSelect:"text",...o},children:y})});function Re(){const[s,y]=a.useState({center:[25.035751357120876,121.52047467202769],zoom:12}),[o,H]=a.useState(),[X,Q]=a.useState([]);console.log(X);const[T,q]=a.useState(0),[d,K]=a.useState(0),[N,ee]=a.useState(0),[I,te]=a.useState(["",""]),[se,ie]=a.useState(0),[oe,ne]=a.useState(0),[C,B]=a.useState(!1),[L,le]=je.useMessage(),l=Me();a.useEffect(()=>{const t=localStorage.getItem("page3_02-viewport");t&&y(JSON.parse(t))},[]);const re=async()=>{try{return(await U.get("https://tcgbusfs.blob.core.windows.net/dotapp/youbike/v2/youbike_immediate.json")).data}catch(t){console.log(t.message)}};console.log("render....");const{data:x,status:ae,isLoading:j,isFetching:b}=$(["TaipeiYouBike"],re,{refetchOnWindowFocus:!1,keepPreviousData:!0,cacheTime:6e4,staleTime:1/0,refetchInterval:6e4}),ce=async()=>{try{return(await U.get("https://data.ntpc.gov.tw/api/datasets/010e5b15-3823-4b20-b401-b1cf000550c5/json?size=1000")).data}catch(t){console.log(t.message)}};console.log("render....");const{data:A,status:de,isLoading:h,isFetching:u}=$(["fetchNewTaipeiYouBikeAPI"],ce,{refetchOnWindowFocus:!1,keepPreviousData:!0,cacheTime:6e4,staleTime:1/0,refetchInterval:6e4});a.useEffect(()=>{(ae==="success"||de==="success")&&(console.log("data",x),console.log("newTaipeiYoubike",A),H(x),Q(A))},[x,A]);const pe=t=>{localStorage.setItem("page3_02-viewport",JSON.stringify(t))};a.useEffect(()=>{localStorage.setItem("page3_02-viewport",JSON.stringify(s))},[C]);const xe=()=>Z.divIcon({className:"",html:k(e.jsx(e.Fragment,{children:e.jsx(ze,{style:{color:"#263ea0",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}})}))}),ge=(t,i,n,r)=>Z.divIcon({className:"",html:k(e.jsx("div",{children:r==="1"&&i/n>=3?e.jsx(g,{style:{color:"#cf1322",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):r==="1"&&i/n>=2?e.jsx(g,{style:{color:"#d48806",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):r==="1"?e.jsx(g,{style:{color:"#006400",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}}):r==="0"&&e.jsx(Te,{style:{color:"#dc3545",fontSize:"1.8rem",marginLeft:"-11px",marginTop:"-20px"}})},t))}),he=({tot:t,bemp:i,sbi:n,updateTime:r})=>{const p=(i/t*100).toFixed(2);return{tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},graphic:[{type:"text",left:"center",top:"35%",style:{text:"目前使用量",textAlign:"center",fill:"#555",fontSize:16,fontWeight:"bold"}},{type:"text",left:"center",top:"45%",style:{text:`${p} %`,textAlign:"center",fill:"#555",fontSize:20,fontWeight:"bold"}},{type:"text",left:"center",top:"88%",style:{text:`上次更新時間 ${r}`,textAlign:"center",fill:"#555",fontSize:20,fontWeight:"bold"}}],series:[{name:"Access From",type:"pie",radius:["45%","66%"],center:["50%","45%"],avoidLabelOverlap:!1,label:l.xs?{show:!1}:{show:!0,position:"outside",formatter:`{b}
{c}`,fontSize:14},emphasis:{label:{show:!l.xs,fontSize:16,fontWeight:"bold"}},labelLine:l.xs?{show:!1}:{show:!0},data:[{value:i,name:"可還空位數"},{value:n,name:"可借車位數"}]}]}};a.useEffect(()=>{var E,O,P,Y;const t=o==null?void 0:o.map(c=>c.tot),i=t==null?void 0:t.reduce((c,f)=>c+f+0),n=o==null?void 0:o.map(c=>c.bemp),r=n==null?void 0:n.reduce((c,f)=>c+f+0),p=o==null?void 0:o.map(c=>c.sbi),v=p==null?void 0:p.reduce((c,f)=>c+f+0),me=(O=(E=o==null?void 0:o[600])==null?void 0:E.mday)==null?void 0:O.toString().slice(-8),ye=(Y=(P=o==null?void 0:o[600])==null?void 0:P.mday)==null?void 0:Y.toString().slice(0,10);q(i),K(r),ee(v),te([ye,me])},[o]);const ue=()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){const{latitude:i,longitude:n}=t.coords;ie(i),ne(n),y(r=>({...r,center:[i,n],zoom:l.xs?16:18})),B(!0)},function(t){t.code===t.PERMISSION_DENIED?L.warning("請開啟瀏覽器位置存取權限!"):console.log(`無法取得位置：${t.message}`)}):(L.error("瀏覽器不支援地理位置服務"),console.log("瀏覽器不支援地理位置服務"))},W=x==null?void 0:x.reduce((t,i)=>{const{sarea:n}=i;return t[n]||(t[n]=[]),t[n].push(i),t},{}),w={};function F(t,i){return t.reduce((n,r)=>n+Number(r[i]),0)}W&&Object.entries(W).forEach(([t,i])=>{const n=F(i,"tot"),r=F(i,"bemp"),p=F(i,"sbi"),v=(r/n*100).toFixed(2);w[t]={tot:n,bemp:r,sbi:p,util:v}}),console.log(w);const fe={xAxis:{type:"category",data:Object.keys(w),axisLabel:{interval:0,rotate:45}},yAxis:{type:"value"},series:[{data:Object.values(w).map(t=>t.util),type:"bar",showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},label:{show:!0,offset:[130,-130],position:"insideBottom",formatter:"{c} %",rotate:40,color:"gary",fontWeight:"bold"}}]};return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{children:[e.jsx(S,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(z,{title:"目前場站所有總停車格",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:j||b||u||h||T===0||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#002FA7"},children:T})})}),e.jsx(S,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(z,{title:"目前所有可還空位數",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:j||b||u||h||d===0||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#002FA7"},children:d})})}),e.jsx(S,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(z,{title:"各行政區使用量",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:u||h||N===0||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx(J,{option:fe,style:{height:"303px",width:"100%"},notMerge:!0,lazyUpdate:!0})})}),e.jsx(S,{xs:24,sm:24,md:24,lg:12,xl:12,xxl:6,children:e.jsx(z,{title:"當前使用量 ｜ 數據更新時間",bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:j||b||u||h||I[1]===""||d===void 0?e.jsx(e.Fragment,{children:e.jsx(m,{})}):e.jsx(J,{option:he({tot:T,bemp:d,sbi:N,updateTime:I[1]}),style:{height:"303px",width:"100%"},notMerge:!0,lazyUpdate:!0})})})]}),e.jsxs(M,{bodyStyle:{margin:5,padding:0,height:"100%"},children:[e.jsx("div",{style:{margin:0,padding:0},children:e.jsxs(we,{viewport:s,onViewportChange:pe,style:{height:"calc(55vh - 65px)"},children:[e.jsx(ve,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> 貢獻者',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsxs(Se,{disableClusteringAtZoom:16,removeOutsideVisibleBounds:!0,spiderfyDistanceMultiplier:1,showCoverageOnHover:!0,maxClusterRadius:35,children:[o==null?void 0:o.map((t,i)=>e.jsxs(G,{position:[t.lat,t.lng],icon:ge(i,t.tot,t.sbi,t.act),children:[e.jsx(R,{direction:"bottom",offset:[0,7],children:t.sna}),e.jsx(V,{offset:[0,-13],children:e.jsxs(M,{bodyStyle:l.xs?{display:"inline-block",padding:"5px 0 5px 0"}:{display:"inline-block",padding:15},children:[e.jsx(De,{title:e.jsx("div",{style:l.xs?{fontSize:"1rem",padding:"0 15px 0 15px"}:{fontSize:"1.2rem",maxWidth:"244px",whiteSpace:"pre-line"},children:l.xs?t.sna.replace(/\([^)]*\)/g,"").replace("YouBike2.0_",""):t.sna.replace("YouBike2.0_","")}),description:t.sarea,style:l.xs?{fontSize:"0.9rem",textAlign:"center"}:{textAlign:"center"}}),e.jsx("hr",{style:{color:"gray",width:"90%",marginTop:"10px"}}),j||b||u||h?e.jsx(e.Fragment,{children:e.jsx(m,{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",height:"171.93800px"}})}):e.jsxs(e.Fragment,{children:[t.tot&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["場站總停車格：",t.tot]}):e.jsxs("p",{children:["場站總停車格：",t.tot]})}),t.sbi>=0&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["可借車位數：",t.sbi]}):e.jsxs("p",{children:["可借車位數：",t.sbi]})}),t.bemp&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 0 0",padding:"0 0 0 15px"},children:["可還空位數：",t.bemp]}):e.jsxs("p",{children:["可還空位數：",t.bemp]})}),t.mday&&e.jsx(e.Fragment,{children:l.xs?e.jsxs("h6",{style:{fontSize:"1rem",textAlign:"left",margin:"10px 0 10px 0",padding:"0 0 0 15px"},children:["更新時間：",t.mday.slice(11,19)]}):e.jsxs("p",{children:["上次更新時間：",t.mday]})}),t.lat&&t.lng&&(l.xs?e.jsx(e.Fragment,{children:e.jsx("a",{href:`comgooglemaps://?daddr=${t.lat},${t.lng}&directionsmode=walking`,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"1rem",textAlign:"left",padding:"0 0 0 15px",margin:"0 0 10px 0 "},children:"打開 Google 地圖導航"})}):e.jsx(e.Fragment,{children:e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${t.lat},${t.lng}`,target:"_blank",rel:"noopener noreferrer",children:"打開 Google 地圖導航"})})),t.act==="0"&&e.jsx(e.Fragment,{children:e.jsx("p",{style:l.xs?{color:"red",textAlign:"center",fontSize:"1.2rem",fontWeight:"bold"}:{color:"red",textAlign:"center",fontSize:"1.2rem",margin:"10px 0 0 0 ",fontWeight:"bold"},children:"此站目前為禁用狀態"})})]})]})})]},`${t.lat}-${t.lng}-${i}`)),C&&e.jsxs(G,{position:[se,oe],icon:xe(),children:[e.jsx(R,{direction:"bottom",offset:[-3,8],permanent:!0,children:"我的位置"}),e.jsx(V,{offset:[-3,-13],closeButton:!1,children:e.jsx(_,{onClick:()=>B(!1),children:"close Marker"})})]})]})]})}),e.jsxs("div",{style:{marginTop:"5px",display:"flex",justifyContent:"space-between",alignItems:"baseline",flexDirection:l.xs?"column":"row"},children:[e.jsxs("div",{children:[e.jsxs(D,{style:{verticalAlign:"4px"},children:["臺北市 YouBike2.0 即時資訊："," "]}),e.jsx(g,{style:{color:"#006400",fontSize:"1.3rem"}}),e.jsx(D,{style:{verticalAlign:"4px"},children:" 充足 "}),e.jsx(g,{style:{color:"#d48806",fontSize:"1.3rem"}}),e.jsx(D,{style:{verticalAlign:"4px"},children:" 適中 "}),e.jsx(g,{style:{color:"#cf1322",fontSize:"1.3rem"}}),e.jsx(D,{style:{verticalAlign:"4px"},children:" 有限 "})]}),e.jsx("div",{children:e.jsx(_,{style:{verticalAlign:"4px",padding:"0 5px 0 5px"},onClick:ue,children:"尋找我的座標"})})]})]}),le]})}export{Ne as Sarea,Ie as Sareaen,Re as default};
